package com.telegram.bilavorona.controler;

import com.telegram.bilavorona.config.MyBotSender;
import com.telegram.bilavorona.model.Role;
import com.telegram.bilavorona.service.UserService;
import com.vdurmont.emoji.EmojiParser;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.telegram.telegrambots.meta.api.objects.Message;


@Slf4j
@Service
public class BotCommandHandlerImpl implements BotCommandHandler {
    private final UserService userService;
    private final MyBotSender botSender;
    private final RoleController roleController;

    private static final String HELP_TEXT = """
                üìã *–ö–æ–º–∞–Ω–¥–∏:*
                
                üîπ /start - –í—ñ—Ç–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.
                üîπ /help - –î–æ–≤—ñ–¥–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è.
                üîπ /contacts - –û—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é
                
                üìÑ *–†–æ–±–æ—Ç–∞ –∑ —Ñ–∞–π–ª–∞–º–∏:*
                üîπ /documentation - –û—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –∑ —Ä–æ–∑–¥—ñ–ª—É –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è.
                üîπ /examples - –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ–Ω–∞–Ω–∏—Ö —Ä–æ–±—ñ—Ç.
                
                üîπ /help_admin - –û—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
                """;
    private static final String HELP_TEXT_ADMIN = """
                üõ† *–ö–æ–º–∞–Ω–¥–∏ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:*
                üîπ /get_all_files - –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ —Ñ–∞–π–ª–∏.
                üîπ /delete_user - –í–∏–¥–∞–ª—è—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ –π–æ–≥–æ —é–∑–µ—Ä–Ω–µ–π–º–æ–º. –ü—Ä–∏–∫–ª–∞–¥: `/delete_user @username`
                üîπ /change_role - –ó–º—ñ–Ω—é—î —Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ –π–æ–≥–æ —é–∑–µ—Ä–Ω–µ–π–º–æ–º. –ü—Ä–∏–∫–ª–∞–¥: `/change_role @username`
                üîπ /send_for_all_user - –í—ñ–¥–ø—Ä–∞–≤–ª—è—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è/—Ñ–∞–π–ª –≤—Å—ñ–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º. –ü—Ä–∏–∫–ª–∞–¥: `/send_for_all_user –ø—ñ—Å–ª—è —á–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ —Ñ–∞–π–ª–∏, –∞–±–æ –Ω–∞–ø–∏—Å–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è`
                üîπ /change_file_group_by_id - –ó–º—ñ–Ω–∏—Ç–∏ –≥—Ä—É–ø—É —Ñ–∞–π–ª—É –∑–∞ –π–æ–≥–æ ID. –ü—Ä–∏–∫–ª–∞–¥: `/change_file_group_by_id 123 DOCUMENTATION`
                üîπ /change_file_group_by_name - –ó–º—ñ–Ω–∏—Ç–∏ –≥—Ä—É–ø—É —Ñ–∞–π–ª—É –∑–∞ –π–æ–≥–æ –Ω–∞–∑–≤–æ—é. –ü—Ä–∏–∫–ª–∞–¥: `/change_file_group_by_name file_name.docx EXAMPLES`
                üîπ /change_file_name_by_id - –ó–º—ñ–Ω–∏—Ç–∏ –Ω–∞–∑–≤—É —Ñ–∞–π–ª—É –∑–∞ –π–æ–≥–æ ID. –ü—Ä–∏–∫–ª–∞–¥: `/change_file_name_by_id 123 new_name.docx`
                üîπ /change_file_name_by_name - –ó–º—ñ–Ω–∏—Ç–∏ –Ω–∞–∑–≤—É —Ñ–∞–π–ª—É –∑–∞ –π–æ–≥–æ –ø–æ—Ç–æ—á–Ω–æ—é –Ω–∞–∑–≤–æ—é. –ü—Ä–∏–∫–ª–∞–¥: `/change_file_name_by_name old_name.docx new_name.docx`
                üîπ /delete_file_by_id - –í–∏–¥–∞–ª–∏—Ç–∏ —Ñ–∞–π–ª –∑–∞ –π–æ–≥–æ ID. –ü—Ä–∏–∫–ª–∞–¥: `/delete_file_by_id 123`
                üîπ /delete_file_by_name - –í–∏–¥–∞–ª–∏—Ç–∏ —Ñ–∞–π–ª –∑–∞ –π–æ–≥–æ –Ω–∞–∑–≤–æ—é. –ü—Ä–∏–∫–ª–∞–¥: `/delete_file_by_name file_name.docx`
                üîπ /get_all_users - –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ –ë–î
                
                üìå *–ü—Ä–∏–º—ñ—Ç–∫–∞:* –ó–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ —Ñ–∞–π–ª–∏ –≤ –ë–î –º–∞—é—Ç—å –ø—Ä–∞–≤–æ —Ç—ñ–ª—å–∫–∏ *–ê–î–ú–Ü–ù–Ü–°–¢–†–ê–¢–û–†–ò*.
    """;
    private static final String START_TEXT = """
‚ú® –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ –æ—Ñ—ñ—Ü—ñ–π–Ω–æ–≥–æ –±–æ—Ç–∞ –∫–æ–º–ø–∞–Ω—ñ—ó "–ë–Ü–õ–ê –í–û–†–û–ù–ê"! üïäÔ∏è
    üìå –ù–∞—à –ø—Ä–æ–¥—É–∫—Ç ‚Äî ¬´–í–µ–ª–∫–æ–Ω–ª–∞–∫ - –ì–ü–ú¬ª ‚Äî —Ü–µ —ñ–Ω–Ω–æ–≤–∞—Ü—ñ–π–Ω–∏–π –¥–≤–æ–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∏–π –±—ñ–æ–ø–æ–ª—ñ–º–µ—Ä, —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –Ω–∞ 100% –∑ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–∏—Ö –æ–ª—ñ–π: üå± —Å–æ—î–≤–æ—ó, —Ä–∏—Ü–∏–Ω–æ–≤–æ—ó —Ç–∞ —ñ–Ω—à–∏—Ö. –ó–∞–≤–¥—è–∫–∏ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ —Ä–æ–∑—á–∏–Ω–Ω–∏–∫—ñ–≤ —Ç–∞ —à–∫—ñ–¥–ª–∏–≤–∏—Ö –ø–æ–ª—ñ–º–µ—Ä—ñ–≤, –≤—ñ–Ω —î –±–µ–∑–ø–µ—á–Ω–∏–º –¥–ª—è –∫–æ–Ω—Ç–∞–∫—Ç—É –∑ —Ö–∞—Ä—á–æ–≤–∏–º–∏ —Ç–∞ –º–µ–¥–∏—á–Ω–∏–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ ü•¶üß¥, —â–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ —Å–∞–Ω—ñ—Ç–∞—Ä–Ω–æ-–≥—ñ–≥—ñ—î–Ω—ñ—á–Ω–∏–º –≤–∏—Å–Ω–æ–≤–∫–æ–º. ‚úÖ
        üîπ –û—Å–Ω–æ–≤–Ω—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ ¬´–í–µ–ª–∫–æ–Ω–ª–∞–∫ - –ì–ü–ú¬ª:
‚Ä¢	üåø –ï–∫–æ–ª–æ–≥—ñ—á–Ω—ñ—Å—Ç—å: –ù–µ –º—ñ—Å—Ç–∏—Ç—å —Ä–æ–∑—á–∏–Ω–Ω–∏–∫—ñ–≤ —ñ –ø–æ–ª—ñ–º–µ—Ä—ñ–≤, —â–æ –º–æ–∂—É—Ç—å —Ä–æ–∑–∫–ª–∞–¥–∞—Ç–∏—Å—è –∑ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è–º —à–∫—ñ–¥–ª–∏–≤–∏—Ö —Å–ø–æ–ª—É–∫.
‚Ä¢	üõ°Ô∏è –ú—ñ—Ü–Ω—ñ—Å—Ç—å: –°—Ç—ñ–π–∫–∏–π –¥–æ –º–µ—Ö–∞–Ω—ñ—á–Ω–∏—Ö –≤–ø–ª–∏–≤—ñ–≤ —Ç–∞ —Ö—ñ–º—ñ—á–Ω–∏—Ö —Ä–µ–∞–≥–µ–Ω—Ç—ñ–≤ üß™, –≤–∫–ª—é—á–∞—é—á–∏ –º–∏–π–Ω—ñ —Ç–∞ –¥–µ–∑—ñ–Ω—Ñ—ñ–∫—É—é—á—ñ –∑–∞—Å–æ–±–∏.
‚Ä¢	üîÑ –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω—ñ—Å—Ç—å: –ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –ø–æ–∫—Ä–∏—Ç—Ç—è –ø—ñ–¥–ª–æ–≥–∏, —Å—Ç—ñ–Ω, –º–µ—Ç–∞–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π, —Ç—Ä—É–±–æ–ø—Ä–æ–≤–æ–¥—ñ–≤ —Ç–∞ —ñ–Ω—à–∏—Ö –ø–æ–≤–µ—Ä—Ö–æ–Ω—å.
‚Ä¢	üõ†Ô∏è –ó—Ä—É—á–Ω—ñ—Å—Ç—å —É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ: –ó–º—ñ—à—É—î—Ç—å—Å—è –≤—Ä—É—á–Ω—É –∞–±–æ –¥—Ä–∏–ª–µ–º üåÄ —É —Å–ø—ñ–≤–≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—ñ –≤—ñ–¥ 1,5 –¥–æ 6:1 –∑–∞ –≤–∞–≥–æ—é —Ç–∞ –Ω–∞–Ω–æ—Å–∏—Ç—å—Å—è —à–ø–∞—Ç–µ–ª–µ–º, –ø–µ–Ω–∑–ª–µ–º –∞–±–æ –≤–∞–ª–∏–∫–æ–º. –ü–æ–ª—ñ–º–µ—Ä–∏–∑—É—î—Ç—å—Å—è –≤—ñ–¥ 1 –¥–æ 6 –≥–æ–¥–∏–Ω. ‚è±Ô∏è
        üåç –°—Ñ–µ—Ä–∏ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è:
‚Ä¢	üè≠ –ü—Ä–æ–º–∏—Å–ª–æ–≤—ñ —Ç–∞ —Ç–µ—Ö–Ω—ñ—á–Ω—ñ –ø—Ä–∏–º—ñ—â–µ–Ω–Ω—è: –ó–∞—Ö–∏—Å—Ç –ø—ñ–¥–ª–æ–≥–∏, —Å—Ç—ñ–Ω, –ø–æ–∫—Ä—ñ–≤–ª—ñ —Ç–∞ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è.
‚Ä¢	ü•´ –•–∞—Ä—á–æ–≤–∞ —Ç–∞ –º–µ–¥–∏—á–Ω–∞ –≥–∞–ª—É–∑—å: –ë–µ–∑–ø–µ—á–Ω–∏–π –∫–æ–Ω—Ç–∞–∫—Ç –∑ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è, –ø–∏—Ç–Ω–æ—é –≤–æ–¥–æ—é, —Å–ø–∏—Ä—Ç–∞–º–∏ —Ç–∞ —Å–æ–∫–∞–º–∏.
‚Ä¢	‚öôÔ∏è –ê–Ω—Ç–∏–∫–æ—Ä–æ–∑—ñ–π–Ω–∏–π –∑–∞—Ö–∏—Å—Ç: –ú–µ—Ç–∞–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó, —Ç—Ä—É–±–æ–ø—Ä–æ–≤–æ–¥–∏, —Ç–µ—Ö–Ω—ñ—á–Ω—ñ —î–º–Ω–æ—Å—Ç—ñ.
‚Ä¢	üè† –ñ–∏—Ç–ª–æ–≤—ñ —Ç–∞ –∫–æ–º–µ—Ä—Ü—ñ–π–Ω—ñ –ø—Ä–∏–º—ñ—â–µ–Ω–Ω—è: –°–ø–æ—Ä—Ç–∏–≤–Ω—ñ –∑–∞–ª–∏, –≥–∞—Ä–∞–∂—ñ, –ø–∞—Ä–∫—ñ–Ω–≥–∏ —Ç–∞ —Å–∫–ª–∞–¥—Å—å–∫—ñ –∫–æ–º–ø–ª–µ–∫—Å–∏.
    üìå –î—ñ–∑–Ω–∞–π—Ç–µ—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ –Ω–∞—à—ñ –ø—Ä–æ–¥—É–∫—Ç–∏ —Ç–∞ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ! üîç
–ù–∞—Ç–∏—Å–∫–∞–π—Ç–µ /start –∞–±–æ –æ–±–µ—Ä—ñ—Ç—å –ø–æ—Ç—Ä—ñ–±–Ω–∏–π —Ä–æ–∑–¥—ñ–ª —É –º–µ–Ω—é. üì≤
‚ùì –Ø–∫—â–æ —É –≤–∞—Å –≤–∏–Ω–∏–∫–ª–∏ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è ‚Äî –º–∏ –∑–∞–≤–∂–¥–∏ —Ä–∞–¥—ñ –¥–æ–ø–æ–º–æ–≥—Ç–∏! üòä
    """;

    private static final String CONTACTS_TEXT = """
üìû –ù–∞—à—ñ –∫–æ–Ω—Ç–∞–∫—Ç–∏ üìû
üè¢ –¢–æ–≤–∞—Ä–∏—Å—Ç–≤–æ –∑ –æ–±–º–µ–∂–µ–Ω–æ—é –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—é ‚Äú–í–ï–õ–ö–û–ù‚Äù

üì≤ –¢–µ–ª–µ—Ñ–æ–Ω: +38098 679 41 20
‚úâÔ∏è e-mail: velkon8@gmail.com

üì° –î–æ—Å—Ç—É–ø–Ω—ñ –º–µ—Å–µ–Ω–¥–∂–µ—Ä–∏:

üì≥ Viber
üí¨ WhatsApp
‚úàÔ∏è Telegram
üîí Signal
üõ† –ó–≤'—è–∑—É–π—Ç–µ—Å—å –∑ –Ω–∞–º–∏ –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ–π —Ç–∞ –∑–∞–º–æ–≤–ª–µ–Ω—å! üí¨
    """;

    @Autowired
    public BotCommandHandlerImpl(UserService userService, MyBotSender botSender, RoleController roleController) {
        this.userService = userService;
        this.botSender = botSender;
        this.roleController = roleController;
    }

    @Override
    public void start(Message msg) {
        String name = msg.getChat().getFirstName();
        log.info("Invoke /start command for user {} in chatId {}", name, msg.getChatId());
        boolean isNewUser = userService.saveUser(msg);
        String greetingForNewUser = "–í—ñ—Ç–∞—é , " + name + ", –ø—Ä–∏—î–º–Ω–æ –ø–æ–∑–Ω–∞–π–æ–º–∏—Ç–∏—Å—å! " + EmojiParser.parseToUnicode(":blush:");
        String greetingForOldUser = "–í—ñ—Ç–∞—é , " + name + "! " + EmojiParser.parseToUnicode(":wave:");
        String answer = isNewUser ? greetingForNewUser : greetingForOldUser;
        botSender.sendMessage(msg.getChatId(), answer);
        botSender.sendMessage(msg.getChatId(), START_TEXT);
    }

    @Override
    public void help(Message msg) {
        log.info("Invoke /help command. Providing help message for user {} in chatId {}", msg.getChat().getUserName(), msg.getChatId());
        botSender.sendMessage(msg.getChatId(), HELP_TEXT);
    }

    @Override
    public void helpAdmin(Message msg) {
        if (!roleController.checkRole(msg.getChatId(), new Role[]{Role.OWNER, Role.ADMIN})) return;
        log.info("Invoke /helpAdmin command. Providing help message for user {} in chatId {}", msg.getChat().getUserName(), msg.getChatId());
        botSender.sendMessage(msg.getChatId(), HELP_TEXT_ADMIN);
    }

    @Override
    public void contacts(Long chatId) {
        log.info("Invoke contacts command in chatId {}", chatId);
        botSender.sendMessage(chatId, CONTACTS_TEXT);
    }

    @Override
    public void defaultCom(Message msg) {
        log.info("Invoke unknown command. Providing default message for user {} in chatId {}", msg.getChat().getUserName(), msg.getChatId());
        String answer = "–ù–µ–≤—ñ–¥–æ–º–∞ –∫–æ–º–∞–Ω–¥–∞. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ /help, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ –∫–æ–º–∞–Ω–¥–∏.";
        botSender.sendMessage(msg.getChatId(), answer);
    }
}
